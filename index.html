<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Get Your Fast Cash Offer | Calgary Home Pricing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-slate-50">
  <div id="root"></div>

  <script type="text/babel">
const { useState, useEffect, useMemo, useRef } = React;

// ============================================
// CONFIGURATION - UPDATE THESE VALUES
// ============================================
const CITY_API = "https://data.calgary.ca/resource/4bsw-nn7w.json";
const MAR_SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTmGFNp9N6A-70xTzu-GQK80WzUzExVhjOM2nsrGrsq8Wv_s2AywjA79Nh550Sulgz96lGwrRJBOBnR/pub?output=csv";
const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse"; // Replace with your actual form ID

// GEMINI API - GET FREE KEY AT: https://aistudio.google.com/apikey
const GEMINI_API_KEY = "AIzaSyC9udD6Ttkx_FAUclcn4QAMVqHXLiyLF5o"; // Replace with your free Gemini API key
const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent";

// Lucide React Icons (CheckCircle, AlertCircle)
const CheckCircle = ({className})=>(
  <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
);
const AlertCircle = ({className})=>(
  <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
);

// Helper to calculate Calgary commission (7% first $100k, 3% balance + 5% GST)
function calcCalgaryCommission(price) {
  const first100k = Math.min(price, 100000);
  const balance = Math.max(price - 100000, 0);
  const baseCommission = (first100k * 0.07) + (balance * 0.03);
  const withGST = baseCommission * 1.05; // Add 5% GST
  return withGST;
}

const ASSUMPTIONS = {
  conditionMult: { excellent: 1.1, good: 1.0, fair: 0.9, poor: 0.75, distressed: 0.6 },
  retail: { 
    closingCostPct: 0.01,
    daysToClose: "45â€“75d" 
  },
  discount: { 
    priceDiscountPct: 0.06,
    closingCostPct: 0.008,
    daysToClose: "25â€“50d" 
  },
  cash: {
    multiplierByCondition: { 
      excellent: 0.88,
      good: 0.85,
      fair: 0.82,
      poor: 0.75,
      distressed: 0.65
    },
    commissionPct: 0.0,
    closingCostPct: 0.002,
    daysToClose: "7â€“14d"
  },
  displayBandPct: 0.05,
  marDefault: 1.07
};

const SELL_REASONS = [
  { value: "asap", label: "Relocation / Sell ASAP" },
  { value: "estate", label: "Inherited / Estate" },
  { value: "repairs", label: "Major Repairs Needed" },
  { value: "privacy", label: "Avoid Showings / Privacy" },
  { value: "testing", label: "Just Testing the Market" },
  { value: "financial", label: "Financial / Behind on Payments" },
  { value: "downsizing", label: "Downsizing / Lifestyle" }
];

const CONDITIONS = [
  { value: "excellent", label: "Excellent (updated)" },
  { value: "good", label: "Good (well-kept)" },
  { value: "fair", label: "Fair (dated)" },
  { value: "poor", label: "Poor (repairs needed)" },
  { value: "distressed", label: "Distressed (major work)" }
];

const TIMELINE_OPTIONS = [
  { value: "within2weeks", label: "Within 2 weeks" },
  { value: "within30days", label: "Within 30 days" },
  { value: "30to60days", label: "30-60 days" },
  { value: "flexible", label: "Flexible" }
];

const currency = (n)=>"$"+(Math.round(n).toLocaleString());

function chooseBest(reason, condition){
  if(reason === "financial") {
    if(condition === "excellent" || condition === "good") return "discount";
    return "cash";
  }
  
  if(reason === "asap") {
    if(condition === "excellent" || condition === "good") return "discount";
    return "cash";
  }
  
  if(reason === "repairs" || condition === "poor" || condition === "distressed") {
    return "cash";
  }
  
  if(reason === "privacy") {
    return "cash";
  }
  
  if(reason === "estate") {
    if(condition === "poor" || condition === "distressed") return "cash";
    return "discount";
  }
  
  if(reason === "testing") {
    return "retail";
  }
  
  return "retail";
}

function getBestFitReason(reason, bestKey) {
  if(bestKey === "cash") {
    if(reason === "financial") return "Fast closing with no contingencies gives you the certainty you need.";
    if(reason === "asap") return "Fastest path to closing - no repairs, no showings, no delays.";
    if(reason === "repairs") return "Sell as-is without spending time or money on fixes.";
    if(reason === "privacy") return "One viewing, no ongoing showings or strangers through your home.";
    if(reason === "estate") return "Simplest option for inherited properties - handle remotely if needed.";
    return "No repairs, no showings, no uncertainty - close in days.";
  }
  
  if(bestKey === "discount") {
    if(reason === "asap") return "Priced to move fast while still getting solid market value.";
    if(reason === "estate") return "Quick sale with minimal involvement required.";
    return "Good balance of speed and value for your timeline.";
  }
  
  return "Given your timeline and market conditions, maximizing price makes sense.";
}

// ============================================
// ============================================
// AI ANALYSIS FUNCTION USING GEMINI
// ============================================

async function fetchAIAnalysis(cityData, userInputs, options, bestKey) {
  if (!GEMINI_API_KEY || GEMINI_API_KEY === "AIzaSyC9udD6Ttkx_FAUclcn4QAMVqHXLiyLF5o") {
    console.log('Gemini API key not configured - skipping AI analysis');
    return null;
  }

  try {
    const strategyName = bestKey === 'retail' ? 'List on MLS (Full Retail)' : 
                        bestKey === 'discount' ? 'Quick-List (As-Is / Minimal Prep)' : 
                        'Verified Cash Buyer (No Showings)';

    const prompt = `You are a Calgary real estate expert analyzing seller options for November 2025.

PROPERTY DETAILS:
Address: ${cityData.address}
Community: ${cityData.community}
City Assessment: ${currency(cityData.assessed)}
Market Adjustment Ratio (MAR): ${userInputs.mar.toFixed(2)}
Adjusted Market Value: ${currency(userInputs.marketValue)}

SELLER SITUATION:
Condition: ${CONDITIONS.find(c => c.value === userInputs.condition)?.label}
Selling Reason: ${SELL_REASONS.find(r => r.value === userInputs.reason)?.label}
Timeline: ${TIMELINE_OPTIONS.find(t => t.value === userInputs.timeline)?.label}

RECOMMENDED STRATEGY: ${strategyName}
Expected Net Proceeds: ${currency(options[bestKey].netLow)} - ${currency(options[bestKey].netHigh)}
Time to Close: ${options[bestKey].speed}

Based on current Calgary market conditions and the seller's specific situation, provide 2-3 sentences of personalized insight explaining:
1. Why this strategy makes sense for their timeline and property condition
2. One specific market factor they should consider (interest rates, inventory levels, seasonal trends, or buyer demand in their area)

Be conversational, specific to Calgary, and focus on practical advice. Do not use asterisks or special formatting.`;

    const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }] }],
        generationConfig: {
          temperature: 0.7,
          maxOutputTokens: 200,
        }
      })
    });

    if (!response.ok) {
      console.error('Gemini API error:', response.status);
      return null;
    }

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || null;
  } catch (error) {
    console.error('Error fetching AI analysis:', error);
    return null;
  }
}

// ============================================
// MAIN APP COMPONENT
// ============================================

function App(){
  const [address, setAddress] = useState("");
  const [matches, setMatches] = useState([]);
  const [searching, setSearching] = useState(false);
  const [cityData, setCityData] = useState(null);
  const [marData, setMarData] = useState({});
  
  const [condition, setCondition] = useState("");
  const [reason, setReason] = useState("");
  const [timeline, setTimeline] = useState("");
  const [show, setShow] = useState(false);
  
  const [loadingInsights, setLoadingInsights] = useState(false);
  const [aiAnalysis, setAiAnalysis] = useState(null);
  
  const resultsRef = useRef(null);
  const mapIframeRef = useRef(null);

  useEffect(()=>{
    fetch(MAR_SHEET_URL)
      .then(r=>r.text())
      .then(csv=>{
        const lines=csv.trim().split("\n").slice(1);
        const obj={};
        lines.forEach(line=>{
          const parts=line.split(",");
          if(parts.length>=2){
            const comm=parts[0].trim().toLowerCase();
            const marVal=parseFloat(parts[1]);
            if(!isNaN(marVal)) obj[comm]=marVal;
          }
        });
        setMarData(obj);
      });
  },[]);

  useEffect(()=>{
    if(!address.trim()){
      setMatches([]);
      return;
    }
    const t=setTimeout(()=>{
      setSearching(true);
      fetch(`${CITY_API}?$limit=10&$q=${encodeURIComponent(address)}`)
        .then(r=>r.json())
        .then(d=>{
          setMatches(d);
          setSearching(false);
        })
        .catch(()=>setSearching(false));
    },300);
    return ()=>clearTimeout(t);
  },[address]);

  const handleSelect=(item)=>{
    setCityData(item);
    setAddress(item.address);
    setMatches([]);
    setShow(false);
    setAiAnalysis(null);
    
    // Update map with satellite view
    if (mapIframeRef.current && item.latitude && item.longitude) {
      const mapUrl = `https://maps.google.com/maps?q=${item.latitude},${item.longitude}&t=k&z=18&output=embed`;
      mapIframeRef.current.src = mapUrl;
    }
  };

  const handleShowOptions = async () => {
    setShow(true);
    setLoadingInsights(true);
    setAiAnalysis(null);
    
    setTimeout(() => {
      resultsRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);

    // Fetch AI analysis if options are available
    if (options && marketCore) {
      const userInputs = {
        condition,
        reason,
        timeline,
        mar: marketCore.mar,
        marketValue: marketCore.market
      };

      try {
        const analysis = await fetchAIAnalysis(cityData, userInputs, options, bestKey);
        setAiAnalysis(analysis);
      } catch (error) {
        console.error('Error getting AI analysis:', error);
      } finally {
        setLoadingInsights(false);
      }
    } else {
      setLoadingInsights(false);
    }
  };

  const marketCore = useMemo(()=>{
    if(!cityData || !condition) return null;
    const mar = marData[cityData.community.toLowerCase()] || ASSUMPTIONS.marDefault;
    const condMult = ASSUMPTIONS.conditionMult[condition];
    const market = Math.round(cityData.assessed * mar * condMult);
    return { mar, condMult, market };
  },[cityData, condition, marData]);

  const options = useMemo(()=>{
    if(!marketCore) return null;
    const band=ASSUMPTIONS.displayBandPct;
    
    const retail=(()=>{ 
      const g=marketCore.market;
      const f=calcCalgaryCommission(g);
      const c=g*ASSUMPTIONS.retail.closingCostPct;
      const n=g-f-c; 
      return {
        key:"retail",
        title:"List on MLS (Full Retail)",
        gross:g,
        fee:f,
        close:c,
        net:n,
        speed:ASSUMPTIONS.retail.daysToClose,
        notes:["Max exposure & price","Prep, showings, conditions typical"]
      };
    })();
    
    const discount=(()=>{ 
      const b=marketCore.market*(1-ASSUMPTIONS.discount.priceDiscountPct);
      const f=calcCalgaryCommission(b) * 0.85;
      const c=b*ASSUMPTIONS.discount.closingCostPct;
      const n=b-f-c; 
      return {
        key:"discount",
        title:"Quick-List (As-Is / Minimal Prep)",
        gross:b,
        fee:f,
        close:c,
        net:n,
        speed:ASSUMPTIONS.discount.daysToClose,
        notes:["Fewer showings","Some price tradeoff for speed"]
      };
    })();
    
    const cash=(()=>{ 
      const m=ASSUMPTIONS.cash.multiplierByCondition[condition]??0.85;
      const b=marketCore.market*m;
      const f=b*ASSUMPTIONS.cash.commissionPct;
      const c=b*ASSUMPTIONS.cash.closingCostPct;
      const n=b-f-c; 
      return {
        key:"cash",
        title:"Verified Cash Buyer (No Showings)",
        gross:b,
        fee:f,
        close:c,
        net:n,
        speed:ASSUMPTIONS.cash.daysToClose,
        notes:["Fast, certain closing","Lower price = speed & convenience","As-is condition accepted"]
      };
    })();
    
    const addRange=o=>({
      ...o,
      grossLow:o.gross*(1-band),
      grossHigh:o.gross*(1+band),
      netLow:(o.gross*(1-band))-o.fee-o.close,
      netHigh:(o.gross*(1+band))-o.fee-o.close
    });
    
    return {retail:addRange(retail),discount:addRange(discount),cash:addRange(cash)};
  },[marketCore,condition]);

  const bestKey = useMemo(()=>{
    if(!reason || !condition) return null;
    return chooseBest(reason, condition);
  },[reason, condition]);

  const ready = !!(cityData?.assessed && condition && reason && timeline);

  const handleSubmit = (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const name = formData.get('name');
    const phone = formData.get('phone');
    const email = formData.get('email');
    
    alert(`Thank you ${name}! We'll send your detailed report to ${email} shortly.`);
  };

  // Get community statistics
  const communityStats = useMemo(() => {
    if (!cityData) return null;
    
    // These would ideally come from actual market data
    // For now, using placeholder calculations
    const avgDOM = 48; // Average days on market
    const avgPricePerSqFt = Math.round(cityData.assessed / 1400); // Assuming ~1400 sq ft average
    const medianPrice = Math.round(cityData.assessed * (marData[cityData.community.toLowerCase()] || ASSUMPTIONS.marDefault));
    const activeListings = 42; // Placeholder
    
    return {
      listed: activeListings,
      avgDOM: avgDOM,
      avgPricePerSqFt: avgPricePerSqFt,
      medianPrice: medianPrice
    };
  }, [cityData, marData]);

  return(
    <div className="max-w-4xl mx-auto p-4 py-8">
      <h1 className="text-2xl md:text-4xl font-bold text-slate-800 mb-2">What's Your Home Worth?</h1>
      <p className="text-sm md:text-base text-slate-600 mb-6">Get 3 selling options with realistic net proceeds (retail, quick-list, cash)</p>

      <div className="bg-white rounded-2xl shadow p-4 md:p-6 mb-6">
        <label className="block text-sm md:text-base font-semibold mb-2">Enter Your Calgary Address</label>
        <div className="relative">
          <input
            className="w-full border-2 border-slate-300 rounded-lg p-3 text-sm md:text-base focus:border-blue-500 focus:outline-none"
            placeholder="e.g. 123 Main St SW"
            value={address}
            onChange={(e)=>setAddress(e.target.value)}
          />
          {searching && <div className="absolute right-3 top-3 text-slate-400 text-sm">Searching...</div>}
          {matches.length>0 && (
            <div className="absolute z-10 w-full bg-white border border-slate-200 rounded-lg mt-1 max-h-60 overflow-y-auto shadow-lg">
              {matches.map((m,i)=>(
                <div key={i} onClick={()=>handleSelect(m)} className="p-3 hover:bg-slate-50 cursor-pointer text-xs md:text-sm border-b last:border-b-0">
                  <div className="font-semibold text-slate-800">{m.address}</div>
                  <div className="text-slate-500">{m.community} â€¢ {currency(m.assessed)} assessed</div>
                </div>
              ))}
            </div>
          )}
        </div>

        {cityData && (
          <div className="mt-4 bg-slate-50 rounded-xl p-4">
            <h3 className="font-bold text-slate-800 mb-2 text-sm md:text-base">{cityData.address}</h3>
            <div className="grid grid-cols-2 gap-3 text-xs md:text-sm mb-4">
              <div><span className="text-slate-600">Community:</span> <span className="font-semibold">{cityData.community}</span></div>
              <div><span className="text-slate-600">Assessed:</span> <span className="font-semibold">{currency(cityData.assessed)}</span></div>
            </div>
            
            {/* Map with satellite view */}
            {cityData.latitude && cityData.longitude && (
              <div className="rounded-lg overflow-hidden border border-slate-200">
                <iframe
                  ref={mapIframeRef}
                  width="100%"
                  height="300"
                  style={{ border: 0 }}
                  loading="lazy"
                  src={`https://maps.google.com/maps?q=${cityData.latitude},${cityData.longitude}&t=k&z=18&output=embed`}
                ></iframe>
              </div>
            )}
          </div>
        )}

        {/* Community Statistics Widget */}
        {cityData && communityStats && (
          <div className="mt-6 bg-white border border-slate-200 rounded-xl p-6">
            <h3 className="text-lg md:text-xl font-bold text-slate-800 mb-1">
              Homes for Sale in {cityData.community}
            </h3>
            <p className="text-sm text-slate-500 mb-4">
              {cityData.community} Real Estate Listings â€¢ November 15, 2025
            </p>
            
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-3xl md:text-4xl font-bold text-slate-800">{communityStats.listed}</div>
                <div className="text-sm text-slate-600 mt-1">Listed</div>
              </div>
              <div className="text-center">
                <div className="text-3xl md:text-4xl font-bold text-slate-800">{communityStats.avgDOM}</div>
                <div className="text-sm text-slate-600 mt-1">Avg. DOM</div>
              </div>
              <div className="text-center">
                <div className="text-3xl md:text-4xl font-bold text-slate-800">${communityStats.avgPricePerSqFt}</div>
                <div className="text-sm text-slate-600 mt-1">Avg. $ / Sq.Ft.</div>
              </div>
              <div className="text-center">
                <div className="text-3xl md:text-4xl font-bold text-slate-800">{currency(communityStats.medianPrice)}</div>
                <div className="text-sm text-slate-600 mt-1">Med. List Price</div>
              </div>
            </div>
          </div>
        )}

        {cityData && !show && (
          <div className="mt-6 flex flex-wrap gap-4 items-center justify-between pb-4 border-b">
            <div className="text-sm font-semibold text-slate-700">Tell us about your situation:</div>
            <div className="flex flex-wrap gap-3 text-xs md:text-sm">
              <div className="flex items-center gap-2">
                {condition ? <CheckCircle className="w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0" /> : <div className="w-4 h-4 md:w-5 md:h-5 rounded-full border-2 border-slate-300 flex-shrink-0" />}
                <span className={condition ? "text-slate-600" : "text-slate-400"}>Condition</span>
              </div>
              <div className="flex items-center gap-2">
                {reason ? <CheckCircle className="w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0" /> : <div className="w-4 h-4 md:w-5 md:h-5 rounded-full border-2 border-slate-300 flex-shrink-0" />}
                <span className={reason ? "text-slate-600" : "text-slate-400"}>Reason</span>
              </div>
              <div className="flex items-center gap-2">
                {timeline ? <CheckCircle className="w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0" /> : <div className="w-4 h-4 md:w-5 md:h-5 rounded-full border-2 border-slate-300 flex-shrink-0" />}
                <span className={timeline ? "text-slate-600" : "text-slate-400"}>Timeline</span>
              </div>
            </div>
          </div>
        )}

        <div className="grid md:grid-cols-3 gap-4 mt-4">
          <div>
            <label className="block text-sm font-semibold mb-2">Condition</label>
            <select className="w-full border rounded-lg p-3 text-sm md:text-base" value={condition} onChange={(e)=>setCondition(e.target.value)}>
              <option value="">Select conditionâ€¦</option>
              {CONDITIONS.map(c=><option key={c.value} value={c.value}>{c.label}</option>)}
            </select>
          </div>
          <div>
            <label className="block text-sm font-semibold mb-2">Reason for Selling</label>
            <select className="w-full border rounded-lg p-3 text-sm md:text-base" value={reason} onChange={(e)=>setReason(e.target.value)}>
              <option value="">Select reasonâ€¦</option>
              {SELL_REASONS.map(r=><option key={r.value} value={r.value}>{r.label}</option>)}
            </select>
          </div>
          <div>
            <label className="block text-sm font-semibold mb-2">Timeline to Close</label>
            <select className="w-full border rounded-lg p-3 text-sm md:text-base" value={timeline} onChange={(e)=>setTimeline(e.target.value)}>
              <option value="">Select timelineâ€¦</option>
              {TIMELINE_OPTIONS.map(t=><option key={t.value} value={t.value}>{t.label}</option>)}
            </select>
          </div>
        </div>

        <button disabled={!ready} onClick={handleShowOptions}
          className={`mt-4 px-5 py-3 rounded-lg font-semibold w-full md:w-auto text-sm md:text-base ${ready?"bg-blue-600 text-white hover:bg-blue-700":"bg-slate-300 text-slate-500 cursor-not-allowed"}`}>
          See My Options
        </button>
      </div>

      {show && marketCore && options && (
        <>
          {/* City Assessment Disclaimer */}
          <div className="bg-amber-50 border-l-4 border-amber-400 p-4 mb-6 rounded">
            <div className="flex items-start">
              <AlertCircle className="w-5 h-5 text-amber-600 mr-3 mt-0.5 flex-shrink-0" />
              <div className="text-xs md:text-sm text-amber-900">
                <strong>Important:</strong> City assessments are based on 2025 data 
                and assume average condition. Pricing is calculated based on increases/decreases in pricing per community. For distressed properties or those needing significant repairs, 
                actual market value may differ. We'll verify with current comparable sales upon viewing the property in person.
              </div>
            </div>
          </div>

          {/* NEW: Market Insights Section */}
          {loadingInsights && (
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <div className="flex items-center justify-center gap-3">
                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                <span className="text-sm text-blue-800">Analyzing current market conditions...</span>
              </div>
            </div>
          )}

          {/* AI Analysis Section */}
          {aiAnalysis && (
            <div className="bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-2xl shadow p-4 md:p-6 mb-6">
              <h3 className="text-lg font-bold text-slate-900 mb-3 flex items-center gap-2">
                ðŸ¤– AI Market Analysis
              </h3>
              <p className="text-sm text-slate-700 leading-relaxed">
                {aiAnalysis}
              </p>
            </div>
          )}

          <div ref={resultsRef} className="bg-white rounded-2xl shadow p-4 md:p-6 mb-6">
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
              <Stat label="Community" value={cityData.community.toUpperCase()} />
              <Stat label="City Assessed" value={currency(cityData.assessed)} />
              <Stat label="MAR vs City" value={(marketCore.mar>=1?"+":"")+((marketCore.mar-1)*100).toFixed(1)+"%"} />
              <Stat label="Condition Ã—" value={marketCore.condMult.toFixed(2)} />
            </div>
            <p className="text-xs md:text-sm text-slate-600 mt-3">Core Market Value: <strong>{currency(marketCore.market)}</strong></p>
          </div>

          <div className="grid md:grid-cols-3 gap-4 md:gap-6 mb-6">
            {["retail","discount","cash"].map(k=>{
              const o=options[k];
              const isBest=k===bestKey;
              return(
                <div key={k} className={`rounded-2xl shadow bg-white p-4 md:p-6 border ${isBest?"border-amber-400 border-2":"border-transparent"}`}>
                  {isBest && (
                    <div className="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-3">
                      <div className="flex items-start flex-wrap gap-2">
                        <span className="text-xs font-semibold text-amber-700 bg-amber-100 px-2 py-1 rounded-full flex-shrink-0">
                          Best Fit
                        </span>
                        <p className="text-xs text-amber-800 flex-1">
                          {getBestFitReason(reason, bestKey)}
                        </p>
                      </div>
                    </div>
                  )}
                  <div className="flex justify-between items-start mb-1">
                    <h3 className="font-bold text-slate-800 text-sm md:text-base">{o.title}</h3>
                  </div>
                  <p className="text-xs md:text-sm text-slate-500 mb-3">Speed: {o.speed}</p>
                  <div className="space-y-2 text-xs md:text-sm">
                    <Row label="Estimated Sale Price" value={`${currency(o.grossLow)} â€“ ${currency(o.grossHigh)}`} strong />
                    <Row label="Commission/Fees" value={currency(o.fee)} />
                    <Row label="Closing Costs" value={currency(o.close)} />
                    <div className="border-t pt-2 mt-2">
                      <Row label="Estimated Net" value={`${currency(o.netLow)} â€“ ${currency(o.netHigh)}`} strong big />
                    </div>
                  </div>
                  <ul className="mt-4 space-y-1 text-xs text-slate-600">
                    {o.notes.map((n,i)=><li key={i} className="flex items-start gap-1"><span>â€¢</span><span>{n}</span></li>)}
                  </ul>
                </div>
              );
            })}
          </div>

          <div className="bg-white rounded-2xl shadow p-4 md:p-6">
            <h3 className="text-lg md:text-xl font-bold mb-2">Want exact numbers + next steps?</h3>
            <p className="text-sm md:text-base text-slate-600 mb-4">I'll send verified comparables and (if you want) a same-day cash offer.</p>
            <form onSubmit={handleSubmit} className="grid md:grid-cols-3 gap-3">
              <input required name="name" placeholder="Name" className="border rounded-lg p-3 text-sm md:text-base" />
              <input required name="phone" placeholder="Phone" className="border rounded-lg p-3 text-sm md:text-base" />
              <input required name="email" type="email" placeholder="Email" className="border rounded-lg p-3 text-sm md:text-base" />
              <button className="md:col-span-3 bg-blue-600 text-white font-semibold rounded-lg p-3 mt-2 hover:bg-blue-700 text-sm md:text-base">
                Get My Detailed Report (PDF)
              </button>
            </form>
            <p className="text-xs text-slate-500 mt-2">ðŸ”’ Private & confidential â€¢ Licensed Alberta Realtor</p>
          </div>
        </>
      )}
    </div>
  );
}

function Stat({label,value}){
  return(
    <div className="bg-slate-50 rounded-xl p-3 md:p-4">
      <div className="text-xs uppercase text-slate-500 mb-1">{label}</div>
      <div className="text-sm md:text-lg font-bold text-slate-800 break-words">{value}</div>
    </div>
  );
}

function Row({label,value,strong,big}){
  return(
    <div className="flex justify-between gap-2">
      <div className="text-slate-600">{label}</div>
      <div className={`${strong?"font-bold":""} ${big?"text-base md:text-lg":"text-xs md:text-sm"} text-right`}>{value}</div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<App />);
  </script>
</body>
</html>
